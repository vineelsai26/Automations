name: Run GitHub Backup

on:
    push:
        branches: ["main"]
        paths:
            - "GitHub Backup/**"
            - ".github/workflows/backup.yml"
    schedule:
        - cron: "0 0 * * 5"

env:
    AUTH_TOKEN: ${{ secrets.AUTH_TOKEN }}
    BASE_DIR: ${{ secrets.BASE_DIR }}

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3
            - uses: actions/setup-node@v3
              with:
                  node-version: 18
            - name: Run Backup
              working-directory: GitHub Backup
              run: |
                  git lfs install --skip-smudge
                  yarn
                  yarn build
                  yarn start

            - name: Upload to Google Drive
              uses: adityak74/google-drive-upload-git-action@main
              with:
                  credentials: ${{ secrets.GOOGLE_DRIVE_CREDENTIALS }}
                  filename: "GitHub Backup/repos.zip"
                  folderId: ${{ secrets.FOLDER_ID }}
                  name: "repos.zip" # optional string
                  overwrite: "true" # optional boolean
